---
apiVersion: nnf.cray.hpe.com/v1alpha6
kind: NnfContainerProfile
metadata:
  name: copy-offload-template
  namespace: nnf-system
data:
  storages:
    - name: DW_JOB_my_storage
      optional: false
    - name: DW_GLOBAL_lus
      optional: false
  numPorts: 1
  spec:
    containers:
      - name: copy-offload-srvr
        image: nnf-dm-copy-offload:latest
        command:
          - /nnf-copy-offload
          - --cert
          - $(TLS_CERT_PATH)
          - --cakey
          - $(TLS_KEY_PATH)
          - --tokenkey
          - $(TOKEN_KEY_PATH)
          - --addr
          - :$(NNF_CONTAINER_PORTS)
    # This ServiceAccount is used by the nnf-dm-copy-offload server to talk to
    # the Kubernetes API server. This is ServiceAccount and its Role are
    # defined in config/copy-offload.
    # Normal user containers should not require Kubernetes API server privilege
    # and should not have a service account.
    serviceAccountName: nnf-dm-copy-offload
  retryLimit: 2
